{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import {\n  AppConfigurationClient,\n  featureFlagPrefix,\n  isFeatureFlag,\n  parseFeatureFlag,\n} from \"@azure/app-configuration\";\nimport { inject, ref, type App, type InjectionKey, type Ref } from \"vue\";\n\ntype TypeAppConfigurationClient = AppConfigurationClient | null;\ntype TypeGetFeatureFlag = (name: string, label?: string) => Ref<boolean>;\ntype TypeGetFeatureFlagAsync = (\n  name: string,\n  label?: string\n) => Promise<boolean>;\n\ninterface IFeatureFlagsManager {\n  appConfigurationClient: TypeAppConfigurationClient;\n  getFeatureFlag: TypeGetFeatureFlag;\n  getFeatureFlagAsync: TypeGetFeatureFlagAsync;\n}\n\nconst FeatureFlagsManagerKey: InjectionKey<IFeatureFlagsManager> = Symbol(\n  \"FeatureFlagsManager\"\n);\n\nconst featureFlagsManager = (\n  connectionString?: string\n): IFeatureFlagsManager => {\n  let appConfigurationClient: AppConfigurationClient | null = null;\n\n  if (connectionString) {\n    appConfigurationClient = new AppConfigurationClient(connectionString);\n  }\n\n  const getFeatureFlag = (name: string, label?: string): Ref<boolean> => {\n    const isEnabled = ref(false);\n\n    if (!appConfigurationClient) return isEnabled;\n    try {\n      appConfigurationClient\n        .getConfigurationSetting({\n          key: `${featureFlagPrefix}${name}`,\n          label,\n        })\n        .then((response) => {\n          if (!isFeatureFlag(response)) return isEnabled;\n          isEnabled.value = parseFeatureFlag(response).value.enabled;\n          return isEnabled;\n        });\n    } catch (error) {\n      console.error(\n        \"[App Configuration Plugin] Error retrieving feature flag.\",\n        error\n      );\n    }\n    return isEnabled;\n  };\n\n  const getFeatureFlagAsync = async (\n    name: string,\n    label?: string\n  ): Promise<boolean> => {\n    if (!appConfigurationClient) return false;\n    try {\n      const response = await appConfigurationClient.getConfigurationSetting({\n        key: `${featureFlagPrefix}${name}`,\n        label,\n      });\n      if (!isFeatureFlag(response)) return false;\n      return parseFeatureFlag(response).value.enabled;\n    } catch (error) {\n      console.error(\n        \"[App Configuration Plugin] Error retrieving feature flag.\",\n        error\n      );\n      return false;\n    }\n  };\n\n  return { appConfigurationClient, getFeatureFlag, getFeatureFlagAsync };\n};\n\nfunction AppConfigurationPlugin(app: App, connectionString?: string) {\n  const manager = featureFlagsManager(connectionString);\n  app.provide(FeatureFlagsManagerKey, manager);\n  app.config.globalProperties.featureFlagsManager = manager;\n}\n\nconst useFeatureFlags = () => {\n  const featureFlagsManager = inject(\n    FeatureFlagsManagerKey\n  ) as IFeatureFlagsManager;\n  if (!featureFlagsManager) {\n    throw new Error(\n      \"[App Configuration Plugin] FeatureFlagsManager is not provided.\"\n    );\n  }\n  return featureFlagsManager;\n};\n\nexport { AppConfigurationPlugin, useFeatureFlags };\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACK;AACP,SAAS,QAAQ,WAAkD;AAenE,IAAM,yBAA6D;AAAA,EACjE;AACF;AAEA,IAAM,sBAAsB,CAC1B,qBACyB;AACzB,MAAI,yBAAwD;AAE5D,MAAI,kBAAkB;AACpB,6BAAyB,IAAI,uBAAuB,gBAAgB;AAAA,EACtE;AAEA,QAAM,iBAAiB,CAAC,MAAc,UAAiC;AACrE,UAAM,YAAY,IAAI,KAAK;AAE3B,QAAI,CAAC;AAAwB,aAAO;AACpC,QAAI;AACF,6BACG,wBAAwB;AAAA,QACvB,KAAK,GAAG,iBAAiB,GAAG,IAAI;AAAA,QAChC;AAAA,MACF,CAAC,EACA,KAAK,CAAC,aAAa;AAClB,YAAI,CAAC,cAAc,QAAQ;AAAG,iBAAO;AACrC,kBAAU,QAAQ,iBAAiB,QAAQ,EAAE,MAAM;AACnD,eAAO;AAAA,MACT,CAAC;AAAA,IACL,SAAS,OAAO;AACd,cAAQ;AAAA,QACN;AAAA,QACA;AAAA,MACF;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAEA,QAAM,sBAAsB,CAC1B,MACA,UACqB;AACrB,QAAI,CAAC;AAAwB,aAAO;AACpC,QAAI;AACF,YAAM,WAAW,MAAM,uBAAuB,wBAAwB;AAAA,QACpE,KAAK,GAAG,iBAAiB,GAAG,IAAI;AAAA,QAChC;AAAA,MACF,CAAC;AACD,UAAI,CAAC,cAAc,QAAQ;AAAG,eAAO;AACrC,aAAO,iBAAiB,QAAQ,EAAE,MAAM;AAAA,IAC1C,SAAS,OAAO;AACd,cAAQ;AAAA,QACN;AAAA,QACA;AAAA,MACF;AACA,aAAO;AAAA,IACT;AAAA,EACF;AAEA,SAAO,EAAE,wBAAwB,gBAAgB,oBAAoB;AACvE;AAEA,SAAS,uBAAuB,KAAU,kBAA2B;AACnE,QAAM,UAAU,oBAAoB,gBAAgB;AACpD,MAAI,QAAQ,wBAAwB,OAAO;AAC3C,MAAI,OAAO,iBAAiB,sBAAsB;AACpD;AAEA,IAAM,kBAAkB,MAAM;AAC5B,QAAMA,uBAAsB;AAAA,IAC1B;AAAA,EACF;AACA,MAAI,CAACA,sBAAqB;AACxB,UAAM,IAAI;AAAA,MACR;AAAA,IACF;AAAA,EACF;AACA,SAAOA;AACT;","names":["featureFlagsManager"]}